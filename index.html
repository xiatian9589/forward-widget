<!DOCTYPE html>
<html>
<head>
  <title>Matrix Forward Message Widget</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: sans-serif; padding: 1em; }
    #messages { margin-top: 1em; }
    .message { border-bottom: 1px solid #ccc; padding: 0.5em 0; }
    button { margin-left: 1em; }
  </style>
</head>
<body>
  <h1>Forward Message Widget</h1>
  <div id="messages">Loading messages...</div>

  <script type="module">
    import { MatrixWidgetApi } from "https://esm.sh/matrix-widget-api";

    const widgetApi = new MatrixWidgetApi();

    await widgetApi.requestCapabilities([
      "org.matrix.msc2876.send_event",
      "org.matrix.msc2876.receive_event",
      "org.matrix.msc2876.send_message"
    ]);

    await widgetApi.start();

    const container = document.getElementById("messages");
    container.innerHTML = "<em>Waiting for messages...</em>";

    widgetApi.on("action:org.matrix.msc2876.timeline_event", event => {
      const ev = event.detail.data;
      if (ev.type === "m.room.message" && ev.content?.body) {
        displayMessage(ev.sender, ev.content.body);
      }
    });

    function displayMessage(sender, body) {
      const div = document.createElement("div");
      div.className = "message";
      div.innerHTML = `<strong>${sender}</strong>: ${body} <button>Forward</button>`;
      div.querySelector("button").onclick = async () => {
        const content = {
          msgtype: "m.text",
          body: `Forwarded from ${sender}: ${body}`
        };
        await widgetApi.sendRoomEvent("m.room.message", content);
        alert("Message forwarded!");
      };
      container.appendChild(div);
    }
  </script>
</body>
</html>
